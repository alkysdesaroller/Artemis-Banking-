@model LoanViewModel

@{
    ViewBag.Title = "Detalles del préstamo";
    Layout = "_LayoutAdmin";
}

@if (Model == null)
{
    <div class="alert alert-warning text-center">
        No se encontró información del préstamo.
    </div>
    return;
}

@if (Model.LoanInstallments == null || !Model.LoanInstallments.Any())
{
    <div class="alert alert-warning text-center">
        Este préstamo no posee cuotas registradas.
    </div>
}

<div class="row mb-3">
    <div class="card">
        <div class="card-header fw-bold">
            Información del préstamo
        </div>

        <div class="card-body">

            <div class="row mb-2">
                <div class="col-md-3"><strong>Préstamo ID:</strong></div>
                <div class="col-md-9">@Model.Id</div>
            </div>

            <div class="row mb-2">
                <div class="col-md-3"><strong>Monto solicitado:</strong></div>
                <div class="col-md-9">RD$ @Model.Amount.ToString("N2")</div>
            </div>

            <div class="row mb-2">
                <div class="col-md-3"><strong>Tasa de interés anual:</strong></div>
                <div class="col-md-9">@Model.AnualRate %</div>
            </div>

            <div class="row mb-2">
                <div class="col-md-3"><strong>Plazo:</strong></div>
                <div class="col-md-9">@Model.TermMonths meses</div>
            </div>

            <div class="row mb-2">
                <div class="col-md-3"><strong>Creado:</strong></div>
                <div class="col-md-9">@Model.CreatedAt.ToString("dd/MM/yyyy")</div>
            </div>

            <div class="row mb-2">
                <div class="col-md-3"><strong>Estado:</strong></div>
                <div class="col-md-9">
                    @if (Model.Completed)
                    {
                        <span class="badge bg-success">Completado</span>
                    }
                    else if (Model.IsDue)
                    {
                        <span class="badge bg-danger">Atrasado</span>
                    }
                    else
                    {
                        <span class="badge bg-warning text-dark">Activo</span>
                    }
                </div>
            </div>

        </div>
    </div>
</div>


<div class="row">
    <div class="card">
        <div class="card-header fw-bold">
            Tabla de amortización
        </div>

        <div class="card-body">

            <table class="table table-striped w-100 text-center align-middle">
                <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Fecha de pago</th>
                    <th>Monto cuota</th>
                    <th>Capital</th>
                    <th>Interés</th>
                    <th>Pagado</th>
                    <th>Estado</th>
                </tr>
                </thead>

                <tbody>
                @foreach (var cuota in Model.LoanInstallments)
                {
                    var estadoTexto = cuota.IsPaid
                        ? "Pagada"
                        : cuota.IsDue
                            ? "Atrasada"
                            : "Pendiente";

                    var estadoClase = cuota.IsPaid
                        ? "table-success"
                        : cuota.IsDue
                            ? "table-danger"
                            : "table-warning";

                    <tr class="@estadoClase">
                        <td>@cuota.Id</td>
                        <td>@cuota.PaymentDay.ToString("dd/MM/yyyy")</td>
                        <td>RD$ @cuota.Amount.ToString("N2")</td>
                        <td>RD$ @cuota.CapitalAmount.ToString("N2")</td>
                        <td>RD$ @cuota.InterestAmount.ToString("N2")</td>
                        <td>RD$ @cuota.PaidAmount.ToString("N2")</td>
                        <td><strong>@estadoTexto</strong></td>
                    </tr>
                }
                </tbody>

            </table>
        </div>
    </div>
</div>

<div class="row">
    <div class="d-flex justify-content-center mt-2">
        <div class="me-1">
            <a asp-controller="Loans" asp-action="Index" class="btn btn-warning">Volver</a>
        </div>
    </div>
</div>
